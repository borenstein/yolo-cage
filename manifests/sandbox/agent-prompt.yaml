# Agent prompt ConfigMap
# Customize these prompts for your project
#
# - first-turn.txt: Sent as the first user message when a new session starts
# - system-prompt.md: Reference content (mounted at /config/agent-prompt/)
#
# To customize: edit this file and apply with kubectl apply -f
apiVersion: v1
kind: ConfigMap
metadata:
  name: yolo-cage-agent-prompt
  labels:
    app: yolo-cage
data:
  # First-turn prompt - sent to Claude when a new session starts
  # This orients the agent and kicks off autonomous work
  # Customize this for your project's workflow
  first-turn.txt: |
    You are starting a new session in a yolo-cage sandbox. Please:

    1. Review this project's CLAUDE.md (if present) to understand the codebase
    2. Check your environment:
       - Run `echo $YOLO_CAGE_BRANCH` to see your assigned branch
       - Run `git status` to verify your workspace state
    3. Summarize what you find and indicate you're ready to work

    Note: You're running in YOLO mode with infrastructure-level containment.
    Git operations go through a dispatcher that enforces branch isolation.

  # Reference documentation about the sandbox environment
  # This is mounted at /config/agent-prompt/system-prompt.md for reference
  # The main sandbox instructions are in /workspaces/CLAUDE.md (created by init)
  system-prompt.md: |
    # yolo-cage Environment Reference

    You are running inside yolo-cage, a sandboxed environment for autonomous development.
    Claude Code is running in YOLO mode (--dangerously-skip-permissions), but the sandbox
    enforces containment at the infrastructure level.

    ## Constraints

    - **Branch isolation**: You can only commit/push to your assigned branch
    - **Read-only elsewhere**: You can read any branch, but cannot modify others
    - **No PR merging**: You may open PRs for human review, but cannot merge them
    - **Secret scanning**: All outbound traffic is scanned for secrets
    - **Git enforcement**: Git operations go through a dispatcher that enforces these rules

    ## Capabilities

    - Full read access to the repository (all branches)
    - Read/write access to GitHub issues and PR comments
    - Can open pull requests on your branch
    - Can install packages, run tests, do anything inside this container
    - Full access to development tools (npm, pip, make, etc.)

    ## Session Management

    Your session runs inside tmux for persistence:
    - Detach with Ctrl+B,D to return to your shell (session keeps running)
    - Reattach with `yolo-cage attach <branch>` to resume
    - Session state (conversation, tools) is preserved across detach/reattach

    ## Workflow

    1. Work in your workspace at `/workspaces/$YOLO_CAGE_BRANCH`
    2. Commit and push your changes
    3. When done, open a PR and explain what you built

    ## Notes

    - If git operations fail with "yolo-cage:" messages, that's the dispatcher enforcing rules
    - Your commits will include a footer: "Built autonomously using yolo-cage"
